<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Houston Goes Green</title>

    <!-- Style -->
    <link rel="stylesheet" type="text/css" href="index.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.3/dist/leaflet.css" />
    <!-- leaflet -->
    <script src="https://unpkg.com/leaflet@1.3.3/dist/leaflet.js"></script>
    <!-- Main tangram library -->
    <script src="https://unpkg.com/tangram/dist/tangram.min.js"></script>
    <script src="spin.min.js"></script>
    <script src="leaflet.spin.min.js"></script>

  </head>

  <body>
    <div id="map"></div>
    <div id="overlay">
        <div id="overlay-title">Houston Goes Green</div>
        <div id="overlay-description">
           Houston Texas is one of the fastest growing
           solar energy markets in the United States, it represents a model of success
           for other American cities looking to reduce their carbon footprints.<br><br>
           Houston has a naturally high solar potential due to its location. Additionally,
           it is located in a class 3 geothermal zone which makes geothermal heating and cooling an
           attractive option for homeowners and businesses looking to save money and help combat
           climate change.<br><br>Hover over a building to explore facts about its solar energy
           potential and financial benefits of converting to a geothermal heating and cooling system.<br><br>
        </div>
              <div class = "address-legend">
                <div class = pt-caption> Solar</div>
                <div class = "legend-gradient2"></div>
                <span class = "legend-gradient-label left pt-caption"> Less hours to more hours of annual sunlight <br> <br></span>
                <div class = pt-caption> Geothermal</div>
                <div class = "legend-gradient"></div>
                <span class = "legend-gradient-label right pt-caption"> Increaing savings from geothermal <br><br></span>
              </div>

        <div>
            <button id="solar" class="button solar on" onclick="toggle('solar')">Solar Potenial</button>
            <button id="geothermal" class="button geothermal off" onclick="toggle('geothermal')">Geothermal Savings</button>
        </div>
      </div>

<script>

    var map = L.map('map', {boxZoom: false});
    map.zoomControl.setPosition('bottomright');

    var mode = 'solar';

    var layer = Tangram.leafletLayer({
        scene: 'scene2.yaml',
        attribution: '<a href="https://mapzen.com/tangram" target="_blank">Tangram</a> | &copy; OSM contributors | <a href="https://mapzen.com/" target="_blank">Mapzen</a>',
        events: {
            hover: function(selection) {
                if (mode === 'solar') {
                    if (selection.feature) {
                        showPopup(selection.leaflet_event.latlng, selection.feature.properties.Area, selection.feature.properties.SolarHours, selection.feature.properties.photovoltaic, selection.feature.properties.GTSavings);
                    } else {
                        map.closePopup();
                    }
                }
                if (mode === 'geothermal') {
                    if (selection.feature) {
                        showPopup2(selection.leaflet_event.latlng, selection.feature.properties.Volume, selection.feature.properties.EConsumption, selection.feature.properties.GTSavings);
                    } else {
                        map.closePopup();
                    }
                }
            }
        }
    });

    layer.addTo(map);

    // center of houston
    map.setView([29.7385646,-95.4130037], 17);

    // popups
    var popup = L.popup({closeButton: false});

    function showPopup(latlng, area, hours, power) {
        popup
            .setLatLng(latlng)
            .setContent('<p>This building has a roof area of '+ Math.round(area) +' square meters and receives '+ Math.round(hours) +' hours of sunlight annually. This roof could generate approximately '+ Math.round(area * 4.833 * 365 * 0.02) +' kwh per year worth, ' + Math.round(area * 4.833 * 365 * 0.02 * 0.12) + ' dollars.</p>')
            .openOn(map);
    }

    function showPopup2(latlng, Volume, Cost, Savings) {
        popup
            .setLatLng(latlng)
            .setContent('<p>This building has a volume of approximately '+ Math.round(Volume) +' cubic meters. A building of this size cost approximately '+ Math.round(Cost) +' dollars to heat and cool each year. A geothermal retrofit could save this you '+ Math.round(Savings) +' dollars annually.</p>')
            .openOn(map);
    }
    // Toggle

    function toggle(layerName) {
        mode = layerName
        layers = ['geothermal','solar']
        var index = layers.indexOf(layerName);
        layers.splice(index, 1);

        layer.scene.config.layers["_" + layers[0]].enabled = !layer.scene.config.layers["_" + layers[0]].enabled;
        document.getElementById(layers[0]).className = layer.scene.config.layers["_" + layers[0]].enabled ? "on" : "off";

        layer.scene.config.layers["_" + layerName].enabled = !layer.scene.config.layers["_" + layerName].enabled;
        document.getElementById(layerName).className = layer.scene.config.layers["_" + layerName].enabled ? "on" : "off";
        layer.scene.updateConfig();
    }

</script>

  </body>
</html>
